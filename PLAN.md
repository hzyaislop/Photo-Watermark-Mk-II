# 图片批量加水印应用 - 开发计划文档

本文档详细规划了使用 Electron 和 React 技术栈开发图片批量加水印应用的步骤和阶段。

## 1. 技术选型

- **核心框架**: **Electron** - 一个使用 JavaScript, HTML 和 CSS 构建跨平台桌面应用的成熟框架。
- **前端**: **React** + **TypeScript** - 用于构建现代化、类型安全的用户界面。
- **后端 (图像处理)**: **Node.js** + **Sharp** - 在 Electron 的主进程中运行，`sharp` 是一个高性能的 Node.js 图像处理库。
- **打包工具**: **Electron Forge** 或 **Electron Builder** - 用于将应用打包成可执行文件（如 `.exe`, `.dmg`, `.deb`）。

## 2. 开发阶段

我们将项目分为以下几个主要阶段，以便于迭代和管理。

### 阶段一：项目初始化与基础界面搭建

1.  **环境搭建**:
    -   使用 `electron-forge` 初始化一个包含 React + TypeScript 模板的项目。
    -   安装必要的依赖库，如 `sharp` 用于图像处理。
2.  **创建主窗口**:
    -   配置 Electron 主进程 (`main.js` 或 `index.js`)，创建并设置应用的主窗口尺寸和基本属性。
3.  **UI 布局设计**:
    -   使用 React 构建应用的基础布局，划分为三个主要区域：
        -   **左侧**: 文件导入区和图片列表区。
        -   **中间**: 图片实时预览区。
        -   **右侧**: 水印参数控制区。

### 阶段二：核心功能 - 文件处理与预览

1.  **图片导入**:
    -   **文件选择器**: 在 Electron 主进程中调用 `dialog.showOpenDialog` API，允许用户选择图片和文件夹。
    -   **拖拽导入**: 在前端实现拖拽事件监听，获取拖拽进来的文件路径。
    -   **IPC 通信**: 前端将获取到的文件路径通过 `ipcRenderer` 发送给主进程。
2.  **图片列表**:
    -   主进程验证文件路径和格式后，将合法的图片列表返回给前端。
    -   前端在左侧区域动态渲染图片列表，包含缩略图和文件名。
3.  **图片预览**:
    -   当用户点击列表中的某个图片时，主进程读取该图片文件，将其转换为 Base64 或 Buffer 数据。
    -   数据通过 IPC 返回给前端，在中间的预览区域显示。

### 阶段三：核心功能 - 水印逻辑与实时预览

1.  **后端水印处理**:
    -   在主进程中，使用 `sharp` 库编写一个核心函数，该函数接收以下参数：`原图路径`、`水印类型` (文本/图片)、`水印参数` (内容、颜色、透明度、位置等)。
    -   函数处理后，返回一个带有水印的图片 Buffer。
2.  **前端控制面板**:
    -   在右侧区域，使用 React 组件创建所有水印调整控件：
        -   文本输入框 (用于水印内容)。
        -   透明度滑块。
        -   九宫格位置选择按钮。
        -   颜色选择器等。
3.  **实时预览更新**:
    -   当用户调整任何一个水印参数时，前端立即通过 IPC 将 **当前预览的图片路径** 和 **所有水印参数** 发送给主进程。
    -   主进程调用核心水印函数，生成预览图 Buffer，并返回给前端。
    -   前端用新返回的预览图刷新显示，实现“所见即所得”。

### 阶段四：图片导出功能

1.  **导出设置**:
    -   在 UI 中添加“导出”按钮和相关设置选项（输出文件夹、命名规则、JPEG 质量等）。
2.  **调用保存对话框**:
    -   用户点击“导出”后，主进程调用 `dialog.showSaveDialog` 或 `dialog.showOpenDialog` (选择文件夹) 来确定输出位置。
3.  **批量处理**:
    -   主进程启动一个批量处理流程：
        -   遍历图片列表中的每一张图片。
        -   应用当前的水印设置。
        -   根据用户选择的命名规则生成新文件名。
        -   将处理后的图片保存到指定输出文件夹。
    -   在 UI 上提供处理进度反馈（如进度条和已完成数量）。

### 阶段五：高级功能与完善

1.  **图片水印**:
    -   添加一个让用户选择本地图片作为水印的功能。
    -   后端 `sharp` 逻辑增加对图片水印的支持。
2.  **配置模板**:
    -   **保存**: 将当前所有的水印参数设置保存为一个 JSON 对象，并存储在本地（可使用 `app.getPath('userData')` 获取应用数据目录）。
    -   **加载**: 读取并解析本地的模板文件，恢复到 UI 控件上。
    -   **管理**: 提供加载、删除已存模板的界面。
3.  **其他高级功能**:
    -   根据 PRD，逐步实现字体选择、图片缩放、水印旋转等功能。

### 阶段六：打包与分发

1.  **配置打包工具**:
    -   配置 `electron-builder` 或 `electron-forge`，设置应用图标、名称、版本号等信息。
2.  **构建**:
    -   执行打包命令，为目标平台（Windows, macOS, Linux）生成安装包。
3.  **测试**:
    -   在不同操作系统上测试安装和运行情况。
